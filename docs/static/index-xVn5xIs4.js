import E from"https://npm.elemecdn.com/@highlightjs/cdn-assets@11.6.0/es/highlight.min.js";import*as A from"https://npm.elemecdn.com/marked/lib/marked.esm.js";import{marked as w}from"https://npm.elemecdn.com/marked/lib/marked.esm.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function r(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(n){if(n.ep)return;n.ep=!0;const a=r(n);fetch(n.href,a)}})();const D=`# å…³äº\r
æœ¬é¡¹ç›®ä½¿ç”¨äº†OpenAIæä¾›çš„APIæ¥å£ï¼Œè‡ªè´¹è´­ä¹°æ¥å£ï¼Œæ­å»ºæœåŠ¡å™¨æ¥æ„å»ºchatGPTæ¨¡å‹ï¼Œå¹¶ä¸”ä½¿ç”¨äº†markdownè§£ææ–‡æ¡ˆï¼Œè®©å¤§å®¶å¯ä»¥æ–¹ä¾¿çš„ï¼Œæ— éœ€æ¢¯å­ï¼Œæ— éœ€ç™»å½•/è´­ä¹°è´¦å·ï¼Œä½“éªŒä¸€æŠŠAIçš„ä¹è¶£\r
\r
## å…¬å‘Š\r
å¦‚æœå¯„äº†ï¼Œè¯·ç­‰å¾…å‡ å°æ—¶å†æ¥çœ‹çœ‹\r
\r
## Todo\r
+ <s>è‡ªåŠ¨è§£æmarkdown</s>\r
+ <s>é«˜äº®ä»£ç å—</s>\r
+ <s>è‡ªåŠ¨æ»‘åˆ°åº•éƒ¨</s>\r
+ GPT4.0 ğŸ˜†\r
## ä½œè€…\r
**Bigonion**\r
\r
## å¼€æºåè®®\r
\r
**MIT**\r
## Namespace\r
[https://bigonion.cn](https://bigonion.cn)`,P="data:image/svg+xml,%3c?xml%20version='1.0'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20t='1672414313114'%20class='icon'%20viewBox='0%200%201024%201024'%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20p-id='2716'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='200'%20height='200'%3e%3cpath%20d='M0%200h1024v1024H0z'%20fill='%23FF0033'%20fill-opacity='0'%20p-id='2717'%3e%3c/path%3e%3cpath%20d='M240.448%20168l2.346667%202.154667%20289.92%20289.941333%20279.253333-279.253333a42.666667%2042.666667%200%200%201%2062.506667%2058.026666l-2.133334%202.346667-279.296%20279.210667%20279.274667%20279.253333a42.666667%2042.666667%200%200%201-58.005333%2062.528l-2.346667-2.176-279.253333-279.253333-289.92%20289.962666a42.666667%2042.666667%200%200%201-62.506667-58.005333l2.154667-2.346667%20289.941333-289.962666-289.92-289.92a42.666667%2042.666667%200%200%201%2057.984-62.506667z'%20fill='%23111111'%20p-id='2718'%3e%3c/path%3e%3c/svg%3e";let O=`
<div class="closeBox" id="closeAbout">
<img id="closeAboutSvg" class="closeSvg" src=${P} alt="shut">
</div>
`;document.getElementById("view-area").innerHTML=O+N(D);function N(e){return A.marked.parse(e)}document.getElementById("closeAboutSvg").addEventListener("click",()=>{document.getElementById("aboutBox").style.display="none"});document.getElementById("showAbout").addEventListener("click",()=>{document.getElementById("aboutBox").style.display="flex"});const $="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='16'%20height='16'%20fill='%23fff'%20class='bi%20bi-robot'%20viewBox='0%200%2016%2016'%3e%3cpath%20d='M6%2012.5a.5.5%200%200%201%20.5-.5h3a.5.5%200%200%201%200%201h-3a.5.5%200%200%201-.5-.5ZM3%208.062C3%206.76%204.235%205.765%205.53%205.886a26.58%2026.58%200%200%200%204.94%200C11.765%205.765%2013%206.76%2013%208.062v1.157a.933.933%200%200%201-.765.935c-.845.147-2.34.346-4.235.346-1.895%200-3.39-.2-4.235-.346A.933.933%200%200%201%203%209.219V8.062Zm4.542-.827a.25.25%200%200%200-.217.068l-.92.9a24.767%2024.767%200%200%201-1.871-.183.25.25%200%200%200-.068.495c.55.076%201.232.149%202.02.193a.25.25%200%200%200%20.189-.071l.754-.736.847%201.71a.25.25%200%200%200%20.404.062l.932-.97a25.286%2025.286%200%200%200%201.922-.188.25.25%200%200%200-.068-.495c-.538.074-1.207.145-1.98.189a.25.25%200%200%200-.166.076l-.754.785-.842-1.7a.25.25%200%200%200-.182-.135Z'/%3e%3cpath%20d='M8.5%201.866a1%201%200%201%200-1%200V3h-2A4.5%204.5%200%200%200%201%207.5V8a1%201%200%200%200-1%201v2a1%201%200%200%200%201%201v1a2%202%200%200%200%202%202h10a2%202%200%200%200%202-2v-1a1%201%200%200%200%201-1V9a1%201%200%200%200-1-1v-.5A4.5%204.5%200%200%200%2010.5%203h-2V1.866ZM14%207.5V13a1%201%200%200%201-1%201H3a1%201%200%200%201-1-1V7.5A3.5%203.5%200%200%201%205.5%204h5A3.5%203.5%200%200%201%2014%207.5Z'/%3e%3c/svg%3e",V="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='16'%20height='16'%20fill='%23fff'%20class='bi%20bi-person'%20viewBox='0%200%2016%2016'%3e%3cpath%20d='M8%208a3%203%200%201%200%200-6%203%203%200%200%200%200%206Zm2-3a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm4%208c0%201-1%201-1%201H3s-1%200-1-1%201-4%206-4%206%203%206%204Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516%2010.68%2010.289%2010%208%2010c-2.29%200-3.516.68-4.168%201.332-.678.678-.83%201.418-.832%201.664h10Z'/%3e%3c/svg%3e",f=document.querySelector("form"),m=document.querySelector("#chat_container");function S(){const e=document.getElementById("webSearchToggle"),t=document.getElementById("thinkingToggle"),r=localStorage.getItem("webSearchEnabled"),o=localStorage.getItem("thinkingEnabled");r!==null&&(e.checked=r==="true"),o!==null&&(t.checked=o==="true"),e.addEventListener("change",()=>{localStorage.setItem("webSearchEnabled",e.checked),k()}),t.addEventListener("change",()=>{localStorage.setItem("thinkingEnabled",t.checked)}),k()}function k(){const e=document.getElementById("webSearchToggle").checked,t=document.getElementById("inputArea");e?t.placeholder="Ask chatGPT with web search...":t.placeholder="Ask chatGPT..."}class Z{markedInit(){w.use({mangle:!1,headerIds:!1,strict:!1})}}function G(){new Z().markedInit(),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",S):S()}G();let l;function j(e){var n;e.textContent="";const t=(n=document.getElementById("webSearchToggle"))==null?void 0:n.checked,r=t?["æ­£åœ¨æœç´¢","æ­£åœ¨æœç´¢.","æ­£åœ¨æœç´¢..","æ­£åœ¨æœç´¢...","æ­£åœ¨åˆ†æ","æ­£åœ¨åˆ†æ.","æ­£åœ¨åˆ†æ..","æ­£åœ¨åˆ†æ..."]:[".","..","...",""];let o=0;l=setInterval(()=>{t?(e.textContent=r[o%r.length],o++):(e.textContent+=".",e.textContent==="...."&&(e.textContent=""))},300)}function B(e,t){return t=t.replace(/\n/g,`  
`),new Promise(r=>{let o=0,n=setInterval(()=>{o<t.length?((o==0||o==1)&&u(document.getElementById("chat_container")),e.innerHTML+=t[o],e.innerHTML=e.innerHTML.replace(/  \n/g,"<br />"),e.innerHTML.match(/```/g)&&e.innerHTML.match(/```/g).length%2===0&&(e.innerHTML=w.parse(t.substring(0,o+1)),E.highlightAll(),u(document.getElementById("chat_container"))),document.getElementById("chat_container").scrollHeight-(document.getElementById("chat_container").scrollTop+document.getElementById("chat_container").clientHeight)<45&&u(document.getElementById("chat_container")),o++):o==t.length?(e.innerHTML=w.parse(t),E.highlightAll(),u(document.getElementById("chat_container")),o++):clearInterval(n)},25);r("end")})}function z(){const e=Date.now(),r=Math.random().toString(16);return`id-${e}-${r}`}function L(e,t,r){var n,a;let o="";if(e&&t===""){const s=(n=document.getElementById("webSearchToggle"))==null?void 0:n.checked,c=(a=document.getElementById("thinkingToggle"))==null?void 0:a.checked;let i=[];s&&i.push("ğŸŒ è”ç½‘æœç´¢"),c&&i.push("ğŸ§  æ·±åº¦æ€è€ƒ"),i.length>0&&(o=`<div class="status-indicator">${i.join(" | ")}</div>`)}return`
        <div class= "wrapper ${e&&"ai"}">
            <div class = "chat">
                <div class= "profile">
                    <img 
                    draggable = "false"
                    alt="${e?"bot":"user"}"
                    src="${e?`${$}`:`${V}`}" 
                     />
                </div>
                <div class="message markdown-body-dark" id=${r}>
                  ${o}
                  ${t}
                </div>
            </div>
        <div>
        `}const M=async e=>{var r,o;e.preventDefault();const t=new FormData(f);if(t.get("prompt").replace(/(\s)|(\\n)/g,"")==="")alert("ä½ å•¥éƒ½æ²¡è¾“å…¥ï¼");else{const n=document.getElementById("webSearchToggle").checked,a=document.getElementById("thinkingToggle").checked;m.innerHTML+=L(!1,t.get("prompt"),"yourQues"),f.reset();const s=z();m.innerHTML+=L(!0,"",s),m.scrollTop=m.scrollHeight;const c=document.getElementById(s);j(c);let i={model:"glm-4.5",stream:!0,temperature:.7,messages:[{role:"user",content:t.get("prompt")}]};a&&(i.thinking={type:"enabled"}),n&&(i.tools=[{type:"web_search",web_search:{enable:!0,search_engine:"search_pro",search_result:!0,search_prompt:"ä½ æ˜¯ä¸€ä½æ™ºèƒ½åŠ©æ‰‹ã€‚è¯·ç”¨ç®€æ´æ˜äº†çš„è¯­è¨€æ€»ç»“ç½‘ç»œæœç´¢ç»“æœä¸­çš„å…³é”®ä¿¡æ¯ï¼ŒæŒ‰é‡è¦æ€§æ’åºå¹¶å¼•ç”¨æ¥æºã€‚ä»Šå¤©çš„æ—¥æœŸæ˜¯"+new Date().toLocaleDateString("zh-CN")+"ã€‚",count:5,search_recency_filter:"noLimit",content_size:"high"}}]);try{const d=await fetch("https://open.bigmodel.cn/api/paas/v4/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"4f0f9e54e52e43faadbf24c9a7754b00.Xon9PmRyJShYVVJ7"},body:JSON.stringify(i)});if(!d.body)throw new Error("ReadableStream not supported in this browser.");const x=d.body.getReader(),H=new TextDecoder("utf-8");let b=!1,p="";for(;!b;){const{value:y,done:_}=await x.read();if(b=_,y){const C=H.decode(y,{stream:!0}).split(`
`).filter(g=>g.trim()!=="");for(const g of C)if(g.startsWith("data:")){const I=g.replace("data:","").trim();if(I==="[DONE]"){clearInterval(l),c.innerHTML="",B(c,p);return}try{const h=JSON.parse(I).choices[0];(r=h.delta)!=null&&r.tool_calls&&console.log("Tool calls detected:",h.delta.tool_calls);const T=(o=h.delta)==null?void 0:o.content;T&&(p+=T),h.finish_reason==="tool_calls"&&console.log("Tool calls completed")}catch(v){if(console.error("JSON parse error:",v),!v.message.includes("Unexpected end")){clearInterval(l),c.innerHTML="ã€è§£æé”™è¯¯ã€‘è¯·é‡æ–°å°è¯•ï¼Œå¦‚ä»ç„¶å¤±è´¥ï¼Œè¯·è”ç³»å¤§èªèŠ±ğŸ˜«";return}}}}}clearInterval(l),c.innerHTML="",B(c,p)}catch(d){clearInterval(l),c.innerHTML="ã€è§£æé”™è¯¯ã€‘è¯·é‡æ–°å°è¯•ï¼Œå¦‚ä»ç„¶å¤±è´¥ï¼Œè¯·è”ç³»å¤§èªèŠ±ğŸ˜«",console.error(d)}}};f.addEventListener("submit",M);f.addEventListener("keydown",e=>{e.keyCode===13&&e.ctrlKey&&M(e)});function u(e){var t=e;t.scrollTop=t.scrollHeight}
